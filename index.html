<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="crossorigin=""/>
		<script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>
		<script src="https://cdn.jsdelivr.net/npm/leaflet-vector-tile-layer@0.4.0/dist/VectorTileLayer.umd.min.js"></script>
		<!-- Load Esri Leaflet from CDN -->
		<script src="https://unpkg.com/esri-leaflet@2.3.3/dist/esri-leaflet.js"
		integrity="sha512-cMQ5e58BDuu1pr9BQ/eGRn6HaR6Olh0ofcHFWe5XesdCITVuSBiBZZbhCijBe5ya238f/zMMRYIMIIg1jxv4sQ=="
		crossorigin=""></script>
		<style>
			#mapid {
				height: 700px;
			}
			.leaflet-container { background-color: #FFF }
		</style>
	</head>
	<body>
		<div id="mapid"></div>

		<script>

		// Basemap layers
		var base = {
			'None': L.tileLayer(''),
			'Aerial':  L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
				attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
		  }),
			'Streets': L.tileLayer('https://a.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
			})
		};

		// Layers
		var boundaries = L.esri.featureLayer({ url: 'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Political_Boundaries_Area/FeatureServer/0'});
		boundaries.setStyle({
			color: 'grey',
			weight: 2,
			fill: false
		});
		var hospitals = L.esri.featureLayer({
			url: 'https://carto.nationalmap.gov/arcgis/rest/services/structures/MapServer/6',
			pointToLayer: function (geojson, latlng) {
        return L.circleMarker(latlng, {
					radius: 5,
				  stroke: true, //true/false for stroke
				  color: '#3388ff', //stroke color
				  opacity: 1, //a value between 0 and 1
				  weight: 3, //stroke weight
				  fillColor: '#3288ff', //HEX or color name
				  fillOpacity: .7, //opacity 0-1 of fill
        });
      }
	   });
		hospitals.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{NAME}</strong></p>', layer.feature.properties);
		});
		var va = L.esri.featureLayer({
			url: 'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Veterans_Health_Administration_Medical_Facilities/FeatureServer/0',
			pointToLayer: function (geojson, latlng) {
				return L.circleMarker(latlng, {
					radius: 5,
					stroke: true, //true/false for stroke
					color: '#f03b20', //stroke color
					opacity: 1, //a value between 0 and 1
					weight: 3, //stroke weight
					fillColor: '#ffeda0', //HEX or color name
					fillOpacity: .7, //opacity 0-1 of fill
				});
			}
		 });
		va.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{NAME}</strong></p>', layer.feature.properties);
		});
		var nursingHomes = L.esri.featureLayer({
			url: 'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/ArcGIS/rest/services/NursingHomes/FeatureServer/0',
			pointToLayer: function (geojson, latlng) {
				return L.circleMarker(latlng, {
					radius: 5,
					stroke: true, //true/false for stroke
					color: '#2ca25f', //stroke color
					opacity: 1, //a value between 0 and 1
					weight: 3, //stroke weight
					fillColor: '#e5f5f9', //HEX or color name
					fillOpacity: .7, //opacity 0-1 of fill
				});
			}
		 });
		nursingHomes.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{NAME}</strong></p>', layer.feature.properties);
		});
		var prisons = L.esri.featureLayer({ url: 'https://carto.nationalmap.gov/arcgis/rest/services/structures/MapServer/11' });
		prisons.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{NAME}</strong></p>', layer.feature.properties);
		});
		var publicSchools = L.esri.featureLayer({ url: 'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Public_Schools/FeatureServer/0' });
		publicSchools.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{NAME}</strong></p>', layer.feature.properties);
		});
		var policeStations = L.esri.featureLayer({ url: 'https://carto.nationalmap.gov/arcgis/rest/services/structures/MapServer/30/query' });
		policeStations.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{NAME}</strong></p>', layer.feature.properties);
		});
		var fireStations = L.esri.featureLayer({ url: "https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/Fire_Stations/FeatureServer/0" });
		fireStations.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{NAME}</strong></p>', layer.feature.properties);
		});
		var redCross = L.esri.featureLayer({ url: 'https://hosting.rcview.redcross.org/arcgis/rest/services/Hosted/ARC_Master_Geography_FY19_January/FeatureServer/3' });
		redCross.setStyle({
			color: 'green',
			weight: 3,
			fill: true
		});
		redCross.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{chapter}</strong></p>', layer.feature.properties);
		});
		var redCrossFacilities = L.esri.featureLayer({ url: 'https://services1.arcgis.com/Hp6G80Pky0om7QvQ/arcgis/rest/services/American_Red_Cross_Chapter_Facilities/FeatureServer/0/query?outFields=*&where=1%3D1' });
		redCrossFacilities.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{NAME}</strong></p>', layer.feature.properties);
		});
		var shelters = L.esri.featureLayer({ url: "https://gis.fema.gov/arcgis/rest/services/NSS/FEMA_NSS/FeatureServer/5/" });
		shelters.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{SHELTER_NAME}</strong></p>', layer.feature.properties);
		});
		var bases = L.esri.featureLayer({ url: "https://geo.dot.gov/server/rest/services/NTAD/Military_Bases/MapServer/0" });
		bases.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{SITE_NAME}</strong></p>', layer.feature.properties);
		});
		var airports = L.esri.featureLayer({ url: "https://geo.dot.gov/server/rest/services/NTAD/Airports/MapServer/0" });
		airports.bindPopup(function (layer) {
			return L.Util.template('<p><strong>{Fac_Name}</strong></p>', layer.feature.properties);
		});

    // Add it all together
		var mymap = L.map('mapid', {
			center: [45.9, -93.6],
			zoom: 6,
			layers: [base.None]
		});

		var overlayMaps = {
			"Boundaries": boundaries,
			"Hospitals/Medical Centers": hospitals,
			"Veterans Health Administration Medical Facilities": va,
			"Nursing Homes": nursingHomes,
			"Prisons": prisons,
			"Public Schools (Minnesota)": publicSchools,
			"Police Stations": policeStations,
			"Fire Stations (Minnesota)": fireStations,
			"American Red Cross Chapter Regions": redCross,
			"American Red Cross Chapter Facilities": redCrossFacilities,
			"Minnesota Shelter System Facilities": shelters,
			"Military Bases": bases,
			"Minnesota Airports": airports
		}

		mymap.addLayer(boundaries)
		L.control.layers(base, overlayMaps).addTo(mymap);

		// mymap.on('zoomend', function() {
		// var zoomlevel = mymap.getZoom();
		//     if (zoomlevel  <10){
		//         if (mymap.hasLayer(hospitals)) {
		//             mymap.removeLayer(hospitals);
		//         } else {
		//             console.log("no point layer active");
		//         }
		//     }
		//     if (zoomlevel >= 10){
		//         if (mymap.hasLayer(hospitals)){
		//             console.log("layer already added");
		//         } else {
		//             mymap.addLayer(hospitals);
		//         }
		//     }
		// console.log("Current Zoom Level =" + zoomlevel)
		// });


			// VectorTileLayer('data/boundary/{z}/{x}/{y}.pbf', {
			// 	minDetailZoom: 0,
			// 	maxDetailZoom: 8,
			// 	vectorTileLayerStyles: {
			// 		cb_2017_us_county_500k: {
			// 			weight: 1,
			// 			color: '#000000',
			// 			opacity: 0.2,
			// 			fill: false
			// 		},
			// 		cb_2015_us_state_500k: {
			// 			weight: 3,
			// 			color: '#000000',
			// 			opacity: 0.2,
			// 			fill: false
			// 		}
			// 	}
			// }).addTo(mymap);
			//
			// VectorTileLayer('data/county_cases/{z}/{x}/{y}.pbf', {
			// 	minDetailZoom: 0,
			// 	maxDetailZoom: 8,
			// 	style: function(f, name) {
			// 		//console.log(f, name);
			// 		const cases = f.properties.cases;
			//
			// 		const ln_cases = Math.log(cases);
			// 		const gb = 215 - Math.floor(ln_cases * 255 / 7);
			// 		const rgb = (255 << 16) + (gb << 8) + (gb)
			//
			// 		return ({
			// 			stroke: false,
			// 			fillColor: '#'+rgb.toString(16),
			// 			fill: true
			// 			});
			// 	}
			// }).addTo(mymap);

			// query?outFields=*&where=UPPER(STATE)%20like%20'%25MN%25'
		</script>
	</body>
</html>
